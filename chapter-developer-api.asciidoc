[[developer-api]]
== The GitHub API
Like most useful sites and services today, GitHub is less a site that
you can visit and more a utility that has a habit of popping up just
about everywhere.  As this book has mentioned previously, GitHub has
been quickly becoming a "fixture" for developers.  If you develop in
Ruby, Node.js, and, increasingly, Java you are going to encounter
GitHub as the foundational SCM used by a number of leading projects
and libraries available for your language or platform.  

This ubiquitous presence continues to develop as GitHub's APIs have
started to mature and offer basic utilities for sites that need to
integrate with it. Just like you can sign on to many services with
your Facebook or Twitter logins, GitHub has started to act as an
OAuth 2 provider for many sites and services that depend on GitHub as
a provider of both user identity and Git activity. 

As more developer-focused sites start to offer the ability to "Login
with GitHub", and as GitHub continues to offer more low-level
infrastructure for development it changes from a simple service to a
necessary infrastructure for collaboration. In more than a few ways, GitHub is
to developers as Facebook is to social networks and the API is a
critical component of that transformation.

This chapter will supply three things: 

* A language-neutral overview of the GitHub API along with an
  explanation of basic interaction patterns and pointers toward more
  detailed information.
* A survey of libraries available to make interacting with the GitHub
  APIs easier.
* An exploration of intergration patterns for GitHub's OAuth
  services.

=== API Overview

The GitHub API is a set of REST services that speak JSON.  Some of
these services are available anonymously without the need for
authentication, while others require a set of credentials


An overview of the API with a diagram.



==== High-level Areas 

Activity::

    Activity includes Events, Feeds, Notifications, Starring, and
    Watching.  If you are building a site or service that is focused
    on supporting developers this portion of the API lets us use the
    GitHub API to display information about activity that affects
    everything: users, repositories, and organizations.

Gists::

    Gists are code snippets that can be shared and embedded in other
    sites. Using the GitHub API you can retrieve and populate Gist
    content and use GitHub as the infrastructure for sharing pieces of code.

Git Data::

    This portion of the API allows you to do anything with the GitHub
    API that you can do with the Git command.  If you are familiar
    with the way that Git's plumbing (not the porcelain) works, you
    could write systems that read, create, and manipulate the basic
    building blocks of Git's content-addressable storage backend
    including blobs, trees, tags, and commits.

Issues::

    GitHub's issues management systems is made fully availabel to you
    via the GitHub API.  If you need to create custom systems to
    create and read GitHub issues, issue comments, issues events,
    issue labels, or if you want to see which issues relate to a
    repository milestone the Issues section of the API is where you'll look.

Orgs::

    Repositoryies and individuals associated with organizations can be
    read and manipualted from the Org Teams API.  If you wanted to
    render a list of developers contributing to a repository on a web
    site you could use this section of the API to obtain this information.

Pull Requests::

    With the Pull Requests section of the GitHub API you can create a
    pull request, view a pull request, updated a pull request, comment
    on a pull request, and merge a pull request.

Repositories::

    The Repos API gives you access to lists of repositories by user
    and by organization. It also provides access to teams, tags,
    branches, and contributors associated with a repository.

Users::

    You can read a user, read the current authenicated user, update
    your own user, list a user's followers, update followers, and
    check to see if a user if following another.  This section of the
    API also allows you to see public keys for a user and 

Search::

    GitHub has spent a good amont of effort over the past few years
    creating a very feature-rich search function and they've made this
    search apability available via the GitHub API.

In summary, you would have to work to figure out something that GitHub
isn't making available via the GitHub API.  They done this for a few
reasons, one is that GitHub has become an essential piece of
infrastructure for a large portion of both open source and proprietary
development.  Allowing other companies and sites to build upon GitHub
via the API only guarantees that it will continue to provide these
features and functions going forward.

The other reason GitHub has invested in what some would consider a
radically open approach to its API is that the founders of the company
understand that they don't hold a monopoly on good ideas. Throughout
its history GitHub has had a track record of nonchalantly allowing
people to do what they will with the service.  By enabling others to
build upon these APIs, GitHub understands that others may show up with
better ideas of how to assemble these functions into viable products.

This isn't to say that GitHub is disinterested in your use of the
API.  The company exists to make money, but as money-making ventures
go, GitHub has yet to exercise the sort of measured caution you would
expect from other, more "corporate" attempts at providing an API.
Nowhere in this API do you see anything that hints of GitHub
attempting to hide a property or make something unavailable to attain
a unique market advantage.  

One thing to keep in mind, despite the current, ideal approach tht
GitHub is taking to its API is that your use of this API is still
subject to the arbitrary whim of a commercial entity.

==== How the Read the Github API Documentation

A full exploration of the GitHub API and fine-grained details for each
service is well beyond the scope of this chapter (or even this entire
book).  For more information about the GitHub API, see the
comprehensive GitHub API documentation here:
http://developer.github.com/v3/



Just a pointing to the site with a quick overview of what everything
means.

==== What are the Limitations of the Github API?
GitHub tries to limit the rate at which users can make requests to the
API.  Anonymous requests, requests that haven't authenticated with
either a username/password or OAuth information, are limited to 60
requests an hour. If you are developing a system to integrate with the
GitHub API on behalf of users, clearly 60 requests per hour isn't
going to be sufficient.

This rate limit is increased to 5000 requests per hour if you are
making an authenticated request to the GitHub API, and while this rate
is two orders of magnitude larger than the anonymous rate limit, it
still presents problems if you intend to use your own GitHub
credentials when making requests on behalf of many users.

For this reason, if your web site or service uses the GitHub API to
request informatin from the GitHub API, you should consider using
OAuth and make requests to the GitHub API using your user's shared
authentication information. 

[NOTE]
There are actually two rate limits.  The "core" rate limit and the
"search" rate limit.  The rate limits explained in the previous
paragraphs were for the core rate limit.  For search, anonymous
requests are limited at 20 requests per minute for authenticated user
requests and 5 request per minute for anonymous requests. The
assumption here is that search is a more infrastructure intensive
request to satisfy and that tighter limits are placed on it's usage.

===== Reading Your Rate Limits
Reading your rate limit is straightforward, just make a GET request to
/rate_limit.  This will return a JSON document which tells you the
limit you are subject to, the number of requests you have remaining,
and the timestamp (in seconds since 1970).  Note that this timestamp
has a timezone in Coordinated Universal Time (UTC).

The following command listing uses curl to retrieve the rate limit
for an anonymous request.   This response is abbreviated to save space
in this book, but you'll notice that the quota information is supplied
twice: once in the HTTP response headers and again in the JSON
response.  The rate limit headers are returned with every request to
the GitHub API, so there is little need to make a direct call to the
/rate_limit API.

----
$ curl -i https://api.github.com/rate_limit
HTTP/1.1 200 OK
X-RateLimit-Limit: 60
X-RateLimit-Remaining: 60
X-RateLimit-Reset: 1376252013

{
  "rate": {
    "limit": 60,
    "remaining": 60,
    "reset": 1376252013
  }
}
----

Again, 60 requests of the course of an hour isn't very much, and if
you plan on doing anything interesting, you will likely exceed this
limit quickly. If you are hitting up against the 60 requests per
minute limit, you will likely want to investigate making authenticated
requests to the GitHub API.

The following command listing uses curl to retrieve the rate limit for
an authenticated request.  Again, you will note that the rate limit
information is present in both the response body and the HTTP response
headers.

----
tmac:github-book Tim$ curl -i -u tobrien https://api.github.com/rate_limit
Enter host password for user 'tobrien': xxxxxxxx
HTTP/1.1 200 OK
X-RateLimit-Limit: 5000
X-RateLimit-Remaining: 4995
X-RateLimit-Reset: 1376251941

{
  "rate": {
    "limit": 5000,
    "remaining": 4995,
    "reset": 1376251941
  }
}
----

[NOTE]
Calls to the Rate Limit API are not deducted from your Rate Limit.
Isn't that nice of them?

===== Conditional Requests to Avoid Rate Limits
If you are querying the GitHub APIs to obtain activity data for a user
or a repository, there's a good chance that mamy of your requests
won't return much activity.  If you check for new activity once every
few minutes, there will be time periods over which no activity has
occurred.  These requests, these constant polls still use up requests
in your rate limit even though there's no new activity to be
delivered.

In these cases, you can send conditional HTTP headers
If-Modified-Since and If-None-Match to tell GitHub to return an HTTP
304 response code telling you that nothing has been modified.  When
you send a request with a conditional header and the GitHub responds
with a HTTP 304 response code, this request is not deducted from your
rate limit.

 


////
Maybe this needs more development?  - Tim
////

==== GitHub API Terms of Service
Before you start building a system atop another service's API, it is
always wide to understand what, if any, limitations are placed on that
API's usage.Aside from the limitations on bandwidth, GitHub's API is also covered
by the overall GitHub Terms of Service.   While you can read these terms of
servic here: https://help.github.com/articles/github-terms-of-service
- here is a summary of the terms.

. GitHub isn't liable for any damages that result from youruse of the
API.  You really can't blame GitHub for putting up this clause in
today's litigious society.

. If you abuse the API, GitHub can suspend your account's access to
the API.  They will attempt to contact you before this happens.

. They can change the API.  They can discontinue a part of the API.
They can change it without notice.

This is fairly standard stuff when it comes to terms for an API.
We're not liable, don't abuse it, and we can change it or take it
away.

////
We need guidance from GitHub here.  I don't see that the GitHub API
has any explicit Terms of Service beyond the one every user agrees
to.   It would be nice to know if there are any red lines that can't
be crossed.
////

=== API Security

How is a call to the API secured?

==== Unauthenticated Usage

Public usage of the API, briefly discuss any limitations for
unauthenticated usage.

==== Connecting as Yourself

Just describe simple authentication, how can you make calls to Github
as your own user.

==== Connecting as Someone Else (OAuth)

Reference the larger section on OAuth below.

=== API Libraries

There are already a number of API Libraries available for the Github
API.  This section lists some of the major languages along with some
of the options.

The first two sections of this chapter will deal with the official,
GitHub-maintained client libraries. GitHub maintains two official
libraries which are grouped under the name Octokit - a reference to
Github's Feline Octopus mascot "Octocat".  Octokit maintains two
projects on GitHub - octokit.rb and octokit.objc.

image::images/developer-api-octokit.png[]



==== Connecting to Github from Objective-C






==== Connecting to Github from Ruby

Just have a simple example using the most popular library.  Simple ,
then just some of the alternatives.

https://github.com/octokit/octokit.rb

gem install octokit

==== Connecting to Github from Javascript (Client-side)

Just have a simple example using the most popular library.  Simple ,
then just some of the alternatives.

The following example depends on jQuery, Underscore, and the gh3
Javascript library maintained by Philippe Charriere (GitHub: @k33g) at
GitHub here: https://github.com/k33g/gh3

To run the following example, download underscore-min.js from
http://underscorejs.org/ and gh3.js from https://github.com/k33f/gh3, and
place these files in the same directory as an HTML

----
<html>
  <head>
    <title>GitHub Client Side Example</title>

    <script type="text/javascript"
      src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
    </script>
    <script type="text/javascript" src="underscore-min.js"></script>
    <script type="text/javascript" src="gh3.js"></script>

    <script type="text/javascript">
      $(document).ready( function() {
        var tobrien = new Gh3.User("tobrien");
        tobrien.fetch(function (err, user){
          $('#id').append( user.id );
          $('#login').append( user.login );
          $('#blog').append( user.blog );
          $('#name').append( user.name );
        });
      });
    </script>
  </head>
  <body>
    <h1>GitHub User Information</h1>
    <ul>
      <li id="id">ID: </li>
      <li id="login">Login: </li>
      <li id="blog">Blog: </li>
      <li id="name">Name: </li>
    </ul>
  </body>
</html>
----

----
GitHub User Information

ID: 36787
Login: tobrien
Blog: http://www.discursive.com
Name: Tim O'Brien
----

==== Connecting to Github from Java

The Eclipse project's EGit project maintains a Java library named
egit-github which can be usd independently of Eclipse to interact with
the GitHub API.  The GitHub project page for this egit-github project
can be found here: https://github.com/eclipse/egit-github

If you are using Maven the dependency XML for egit-github is the
following XML dependency.

----
<dependency>
  <groupId>org.eclipse.mylyn.github</groupId>
  <artifactId>org.eclipse.egit.github.core</artifactId>
  <version>2.1.5</version>
</dependency>
----

----
package com.oreilly.github;

import org.eclipse.egit.github.core.Repository;
import org.eclipse.egit.github.core.client.GitHubClient;
import org.eclipse.egit.github.core.client.PageIterator;
import org.eclipse.egit.github.core.event.Event;
import org.eclipse.egit.github.core.service.EventService;
import org.eclipse.egit.github.core.service.RepositoryService;
import org.eclipse.egit.github.core.service.UserService;

public class App
{
    public static void main( String[] args ) throws Exception
    {
        GitHubClient client = new GitHubClient();
        EventService service = new EventService();
        PageIterator<Event> iterator = service.pageUserEvents("tobrien");

        for (Event event : iterator.next() )
          System.out.printf( "%s %s\n", event.getType(), event.getCreatedAt());
    }
}
----

----
WatchEvent Tue Aug 06 05:03:16 CDT 2013
CreateEvent Sun Jul 21 19:57:14 CDT 2013
IssuesEvent Mon Jun 03 09:33:51 CDT 2013
IssuesEvent Mon Jun 03 09:32:54 CDT 2013
PullRequestEvent Mon Jun 03 08:48:51 CDT 2013
CreateEvent Mon Jun 03 08:39:09 CDT 2013
MemberEvent Sun Jun 02 15:51:27 CDT 2013
MemberEvent Sun Jun 02 15:51:18 CDT 2013
MemberEvent Sun Jun 02 15:51:13 CDT 2013
CreateEvent Sun Jun 02 15:51:02 CDT 2013
PublicEvent Sun Jun 02 13:46:52 CDT 2013
----



==== Connecting to Github from Node.js
There is a popular node library that provides access to the GitHub API
developed by Mike de Boer (GitHub: @mikedeboer) this Node.js library
can be found on GitHub here: https://github.com/mikedeboer/node-github

To install the JavaScript GitHub API for Node.js.  Run the following
command with npm - the Node.js package manager:

----
npm install github
----

Once you've installed the github package, you can reference the GitHub
library in code like the following code listing.

----
var GitHubApi = require("github");
var prettyjson = require( 'prettyjson' );

var github = new GitHubApi({
    version: "3.0.0",
    timeout: 5000
});

github.events.getFromUser({
    user: "tobrien"
}, function(err, res) {
    console.log(prettyjson.render(res));
});
----

The code shown above connects to GitHub's API and requests recent
events related to the user "tobrien".  The result of the API call is
then printed out using a utility library named "prettyjson" which
ensures that the JSON output is transformed into something easier to
read. To run this code, you will need to run the following commands:

----
$ npm install github
$ npm install prettyjson
$ node github.js
----

Running this command should yield JSON output that contains a list of
events and actions the user 'tobrien' has recently completed.

For detailed document of Mike de Boer's JavaScript GitHub API, you can
read the full library documentation here:
http://mikedeboer.github.io/node-github/.

While the simple example shown above is sufficient for read-only
operations in the GitHub API, if you are planning on using this API
for anything more than reading GitHub content, you will need to
configure authentication options for this library.  A full discussion
of authentication with the JavaScript GitHub API for Node.js can be
found on the GitHub project page for this library here:
https://github.com/mikedeboer/node-github


==== Connecting to Github from a Billion Alternative Languages

Here is where you can have a list of the availablt APIs, but not a big
one.    We don't need to bother with langauges like Fortran 90.

=== Developing Github Applications

Building systems that interact with Github

===== Example Use-cases for Github Applications

* For discounts at business-affiliated services. (Publishers like O'Reilly Atlas, Prags, Pluralsight)

* For automation integration like Travis-CI

* For sign-in to credentialing services like [CoderWall](http://coderwall.com)

* For sign-in to reputation services like [StackOverflow](http://stackoverflow.com)

===== Authorizing Github Applications

When you develop an application that needs to make use of Github they
need to be authorized using an OAuth workflow...

===== How does OAuth Work?

 [OAuth](http://developer.github.com/v3/oauth/)

===== OAuth Libraries for Github

===== Ruby: Omniauth (with Devise)

Omniauth already has a OAuth provider for Github.

===== Python: ???

Todo: I know that Django has an OAuth provider API, ask a Pythonista.

===== Other Languages

Figure out if there are any other pre-built OAuth integrations (like omniauth)


==== How to call the API

* [API Documentation](http://developer.github.com)

===== Media Types

The content type for these requests and responses is almost always
JSON, but there's a special format required for the media type:
http://developer.github.com/v3/media/

===== This Chapter's Samples: Javascript

This chapter's samples are all written in Javascript, using a sample
web site that you can use over ...here...

===== Other Languages

Refer reader to this page; http://developer.github.com/v3/libraries/




=== A Sample Github Application

This section would build out a sample application.

=== Organization Applications

Registering an Organization's Application










