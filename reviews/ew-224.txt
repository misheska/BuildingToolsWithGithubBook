CHAPTER 9: JavaScript and the Git Data API


                         var Firebase = function (url) {
                         }

                         angular.module( 'firebase', [] );


                         To test our code, we make the following changes to our    coffeetech-

                      annotate.spec.js   :

                         beforeEach( module( "coffeetech" ) );


                         var mockFirebase = mockSimpleLogin = undefined;
                         function generateMockFirebaseSupport() {
                             mockFirebase = function() {};
                             mockSimpleLogin = function() {

                                 return {
                                     '$login': function() {
                                          return { then: function( cb ) {
                                              cb( { name: "someUser",

                                                    accessToken: "abcdefghi" } );
                                          } };
                                     }
                                 }
                             };

                         }

                         var $timeout;
                         beforeEach( inject( function ($controller, $rootScope, $injector ) {

                             generateMockRepositorySupport();
                             generateMockPrompt();
                             generateMockFirebaseSupport();
                             $timeout = $injector.get( '$timeout' );
                             scope = $rootScope.$new();

                             ctrl = $controller( "GithubCtrl", { $scope: scope, Github: ghs, '$timeout': $timeout, '$window': prompter, '$firebase': mocâ–¯kFirebase, '$firebaseSimpleLogin': mockSimpleLogin } );
                         } ) );



                         describe( "#annotate", function() {
                             it( "should annotate a shop", function() {
                                 scope.auth = mockSimpleLogin( mockFirebase() );
                                 scope.city = PORTLAND

                                 var shop = { name: "A coffeeshop" }
                                 scope.annotate( shop );
                                 expect( prompter.prompt.calls.length ).toEqual( 1 );
                                 expect( scope.shopToAnnotate ).toBeTruthy();
                                 expect( scope.username ).not.toBeFalsy();

                                 expect( scope.annotation ).not.toBeFalsy();







       224